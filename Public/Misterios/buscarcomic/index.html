<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Colecciones de CÃ³mics</title>
<script src="/assets/tailwind.js"></script>
<link href="/assets/fonts.css" rel="stylesheet">
<style>
  body {
    font-family: 'Orbitron', sans-serif;
    background-color: #0f172a;
    color: white;
  }

  input[type="number"] {
    @apply w-full bg-gray-800 text-white text-sm px-3 py-2 rounded mt-2 border border-yellow-500 focus:outline-none;
  }

  button {
    @apply bg-yellow-400 text-black font-bold px-4 py-2 rounded mt-2 hover:bg-yellow-500 transition;
  }

  input[type="number"] {
    color: black; 
  }
</style>
</head>
<body>

<nav class="bg-gradient-to-r from-purple-800 via-indigo-800 to-blue-800 p-4 text-center text-sm md:text-base font-semibold uppercase tracking-wider">
  <a href="../../c.html" class="mx-3 hover:text-yellow-400">Inicio</a>
</nav>

<section class="max-w-7xl mx-auto px-6 mb-10">
  <div class="relative flex items-center justify-between">
    <div class="absolute -left-4 md:-left-10 z-20">
  <video autoplay muted loop
         class="w-40 h-40 md:w-52 md:h-52 object-cover rounded-full border-4 border-yellow-400 shadow-2xl">
    <source src="/ruta/busca.mp4" type="video/mp4">
  </video>
    </div>
    <div class="w-full bg-purple-800 h-28 md:h-32 rounded-xl flex items-center pl-48 pr-6 z-10 shadow-lg">
      <h2 class="text-2xl md:text-4xl text-yellow-400 font-bold ml-auto">Busqueda del Comic Olvidado</h2>
    </div>
  </div>

  <nav class="flex justify-end mt-4 space-x-6 text-white text-sm md:text-base">
    <a href="partes.html" class="hover:text-yellow-400 transition" style="font-size: 10px;">Partes de la novela</a>
    <a href="index.html" class="hover:text-yellow-400 transition" style="font-size: 10px;">Personajes</a>
    <a href="influ.html" class="hover:text-yellow-400 transition" style="font-size: 10px;">Influencers</a>
    <a href="resumen.html" class="hover:text-yellow-400 transition" style="font-size: 10px;">Resumen</a>
    <a href="proyecto.html" class="hover:text-yellow-400 transition" style="font-size: 10px;">proyecto</a>
  </nav>
</section>

<main class="max-w-7xl mx-auto px-4">
  <h1 class="text-3xl md:text-4xl text-yellow-400 font-bold mb-10 text-center">ðŸ“š Busqueda del Comic Olvidado</h1>
  <div id="contenedor" class="grid md:grid-cols-3 gap-6 mb-10"></div>
  <div class="text-center">
    <button onclick="resetearDatos()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded font-semibold">Restablecer Valores</button>
  </div>
</main>

<script>
  let colecciones = [];

  async function cargarColecciones() {
    const res = await fetch('/api/colecciones');
    colecciones = await res.json();
    mostrarColecciones();
  }

  function mostrarColecciones() {
    const contenedor = document.getElementById("contenedor");
    contenedor.innerHTML = "";

    colecciones.forEach((coleccion, index) => {
      let card = document.createElement("div");
      card.className = "bg-gray-800 p-4 rounded-xl shadow-lg hover:scale-105 transition text-center";

      card.innerHTML = `
        <h2 class="text-yellow-300 text-xl font-bold mb-2">${coleccion.nombre}</h2>
        <p class="mb-2">Ejemplares: <span id="ejemplares-${index}" class="text-white font-mono">${coleccion.ejemplares}</span></p>
        <p class="mb-2">Pendientes revisar: <span id="pendientes-${index}" class="text-white font-mono">${coleccion.actual}</span></p>
        <input type="number" id="descartar-${index}" placeholder="Cantidad a descartar" min="1">
        <button onclick="descartarEjemplares(${coleccion.id}, ${index})">Descartar</button>
      `;

      contenedor.appendChild(card);
    });
  }

  async function descartarEjemplares(id, index) {
    const input = document.getElementById(`descartar-${index}`);
    const cantidad = parseInt(input.value);

    if (!isNaN(cantidad) && cantidad > 0) {
      const res = await fetch(`/api/colecciones/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ cantidad })
      });

      if (res.ok) {
        const data = await res.json();
        colecciones[index].ejemplares = data.coleccion.ejemplares;
        document.getElementById(`ejemplares-${index}`).textContent = data.coleccion.ejemplares;
        input.value = "";
      } else {
        alert("Error al descartar ejemplares.");
      }
    } else {
      alert("Introduce una cantidad vÃ¡lida.");
    }
  }

  async function resetearDatos() {
    if (confirm("Â¿EstÃ¡s seguro de que quieres restablecer los valores originales?")) {
      const res = await fetch('/api/colecciones/reset', { method: 'POST' });
      if (res.ok) {
        await cargarColecciones();
        alert("Datos restablecidos.");
      } else {
        alert("Error al restablecer los datos.");
      }
    }
  }

  cargarColecciones();
</script>

</body>
</html>
