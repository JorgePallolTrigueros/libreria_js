<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Resumen de la Novela</title>
  <script src="/assets/tailwind.js"></script>
<link href="/assets/fonts.css" rel="stylesheet">
<style>
  body {
    font-family: 'Orbitron', sans-serif;
    background-color: #0f172a;
    color: white;
  }
  .img-left {
    float: left;
    margin: 0 1rem 1rem 0;
    width: 300px;
    border-radius: 0.75rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .img-right {
    float: right;
    margin: 0 0 1rem 1rem;
    width: 300px;
    border-radius: 0.75rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .clear { clear: both; }
  p { text-align: justify; }
  .border-custom { border: solid 3px rgb(250, 204, 21); }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="bg-gradient-to-r from-purple-800 via-indigo-800 to-blue-800 p-4 flex justify-between items-center text-sm font-semibold uppercase tracking-wider">
  <button id="loginBtn" onclick="toggleLogin()" class="text-white hover:text-yellow-400 text-xl" title="Iniciar sesi√≥n">üë§</button>
  <div class="text-center flex-grow">
    <a href="index.html" class="mx-3 hover:text-yellow-400">Inicio</a>
  </div>
</nav>

<!-- Imagen + Filtros -->
<section class="max-w-7xl mx-auto px-6 mb-10">
  <div class="relative flex items-center justify-between">
    <div class="absolute -left-4 md:-left-10 z-20 rounded-full overflow-hidden w-40 h-40 md:w-60 md:h-60 border-custom">
      <video id="videoPrincipal" autoplay muted loop class="w-full h-full object-cover">
        <source id="videoSource" src="" type="video/mp4">
        Tu navegador no soporta video HTML5.
      </video>
    </div>
    <div class="w-full bg-purple-800 h-28 md:h-32 rounded-xl flex items-center pl-48 pr-6 z-10 shadow-lg">
      <h2 id="tituloDinamico" class="text-2xl md:text-4xl text-yellow-400 font-bold ml-auto"></h2>
    </div>
  </div>
  <nav id="dynamicMenu" class="flex justify-end mt-4 space-x-6 text-white text-sm md:text-base"></nav>
</section>

<main class="max-w-5xl mx-auto px-6 space-y-10">
  <section class="bg-gray-900 p-6 rounded-xl shadow-xl">
    <h3 class="text-yellow-400 text-xl font-bold mb-4">Trama del Libro</h3>
    <img id="imagen1" class="rounded-xl shadow-lg object-cover img-left" alt="Imagen 1" />
    <p id="texto1" class="whitespace-pre-wrap text-sm leading-relaxed text-gray-300"></p>
    <div class="clear"></div>

    <img id="imagen2" class="rounded-xl shadow-lg object-cover img-right" alt="Imagen 2" />
    <p id="texto2" class="whitespace-pre-wrap text-sm leading-relaxed text-gray-300"></p>
    <div class="clear"></div>

    <img id="imagen3" class="rounded-xl shadow-lg object-cover img-left" alt="Imagen 3" />
    <p id="texto3" class="whitespace-pre-wrap text-sm leading-relaxed text-gray-300"></p>
    <div class="clear"></div>


<hr class="my-10 border-yellow-400">

<div class="space-y-4">
  <h3 class="text-yellow-400 text-xl font-bold">Editar Textos</h3>
  <button onclick="editarTexto('texto1')" class="bg-yellow-500 text-black px-4 py-2 rounded hover:bg-yellow-400">Editar Texto 1</button>
  <button onclick="editarTexto('texto2')" class="bg-yellow-500 text-black px-4 py-2 rounded hover:bg-yellow-400">Editar Texto 2</button>
  <button onclick="editarTexto('texto3')" class="bg-yellow-500 text-black px-4 py-2 rounded hover:bg-yellow-400">Editar Texto 3</button>
</div>





<div class="my-4">
  <label class="text-sm">üì∏ Subir Imagen 1:</label>
  <input type="file" id="uploadImagen1" onchange="subirImagen(this, 'imagen1')" />
</div>

<div class="my-4">
  <label class="text-sm">üì∏ Subir Imagen 2:</label>
  <input type="file" id="uploadImagen2" onchange="subirImagen(this, 'imagen2')" />
</div>

<div class="my-4">
  <label class="text-sm">üì∏ Subir Imagen 3:</label>
  <input type="file" id="uploadImagen3" onchange="subirImagen(this, 'imagen3')" />
</div>




<hr class="my-10 border-yellow-400">

<div id="notasGPT" class="space-y-4">
  <h3 class="text-yellow-400 text-xl font-bold">Notas del autor</h3>
  <div id="contenedorNotas" class="space-y-4"></div>
  <button onclick="agregarNota()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-500">
    ‚ûï Agregar Nota
  </button>
</div>
<button onclick="guardarResumen()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500">
  üíæ Guardar todo
</button>
  </section>
</main>

<script src="enrrutamiento.js"></script>
<script>
  const params = new URLSearchParams(window.location.search);
  const valor = params.get("valor") || "novela";
  const data = contenido[valor];
let dataActual = { ...data }; // copia editable para guardar


  if (!data) {
    alert("‚ùå Contenido no encontrado para: " + valor);
  } else {
    // Video de cabecera
    document.getElementById("videoSource").src = `ruta/${data.video}`;
    document.getElementById("videoPrincipal").load();

    // T√≠tulo din√°mico
    document.getElementById("tituloDinamico").textContent = data.titulo;

    // Men√∫ din√°mico
    document.getElementById("dynamicMenu").innerHTML = `
  <a href="partes.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Partes de la novela</a>
  <a href="index copy.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Personajes</a>
  <a href="resumen.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Resumen</a>
  <a href="agrupamiento.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">agrupamiento</a>
  <a href="resumen.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Resumen</a>
  <a href="Qui√©nes_estuvieron_ah.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">1 Prueba</a>
  <a href="2_prueba.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">2 Prueba</a>
  <a href="juego3.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">2 Prueba</a>
    <a href="versiones.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Versiones</a>
  <a href="galeria_personaje.html=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">A√±adir Galeria</a>
    `;

    // Rellenar im√°genes y textos
    document.getElementById("imagen1").src = data.imagen1;
    document.getElementById("texto1").textContent = data.texto1;

    document.getElementById("imagen2").src = data.imagen2;
    document.getElementById("texto2").textContent = data.texto2;

    document.getElementById("imagen3").src = data.imagen3;
    document.getElementById("texto3").textContent = data.texto3;

  }




    function editarTexto(id) {
    const textoActual = document.getElementById(id).textContent;
    const nuevoTexto = prompt("Edita el texto:", textoActual);
    if (nuevoTexto !== null) {
      document.getElementById(id).textContent = nuevoTexto;
    }
  }

  const preguntas = [];

  function agregarPregunta() {
    const pregunta = prompt("¬øQu√© pregunta deseas a√±adir?");
    if (pregunta) {
      preguntas.push(pregunta);
      actualizarPreguntas();
    }
  }

function subirImagen(input, idDestino) {
  const archivo = input.files[0];
  if (!archivo) return;

  const formData = new FormData();
  formData.append("imagen", archivo);
  formData.append("valor", valor); // valor = "Jhevis"

  fetch("/api/upload-resumen", {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      const ruta = data.path;
      document.getElementById(idDestino).src = ruta;

      // üß† Asegurar que se actualice en el backend
      if (idDestino === "imagen1") dataActual.imagen1 = ruta;
      if (idDestino === "imagen2") dataActual.imagen2 = ruta;
      if (idDestino === "imagen3") dataActual.imagen3 = ruta;

      // üîÅ Actualizamos directamente
      guardarResumen();

      alert("‚úÖ Imagen subida y guardada.");
    } else {
      alert("‚ùå Error al subir la imagen.");
    }
  })
  .catch(err => {
    console.error("‚ùå Error:", err);
    alert("‚ùå Error de conexi√≥n.");
  });
}




  function actualizarPreguntas() {
    const lista = document.getElementById("preguntasLista");
    lista.innerHTML = "";
    preguntas.forEach((p, i) => {
      const li = document.createElement("li");
      li.textContent = p;
      lista.appendChild(li);
    });
  }

























let notas = Array.isArray(data.array_de_notas) ? [...data.array_de_notas] : [];

function renderNotas() {
  const contenedor = document.getElementById("contenedorNotas");
  contenedor.innerHTML = "";

  notas.forEach((nota, index) => {
    const div = document.createElement("div");
    div.className = "bg-gray-800 p-4 rounded-lg shadow";

    div.innerHTML = `
      <h4 class="text-lg font-semibold text-yellow-300">${nota.titulo}</h4>
      <p class="text-gray-300 text-sm whitespace-pre-wrap">${nota.contenido}</p>
      <div class="mt-2 space-x-2">
        <button onclick="editarNota(${index})" class="bg-yellow-500 text-black px-3 py-1 rounded hover:bg-yellow-400 text-xs">
          ‚úèÔ∏è Editar
        </button>
        <button onclick="eliminarNota(${index})" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-500 text-xs">
          üóëÔ∏è Borrar
        </button>
      </div>
    `;
    contenedor.appendChild(div);
  });
}

function agregarNota() {
  const titulo = prompt("T√≠tulo de la nueva nota:");
  if (!titulo) return;

  const contenido = prompt("Contenido de la nota:");
  if (contenido === null) return;

  notas.push({ titulo, contenido });
  renderNotas();
}

function editarNota(index) {
  const nota = notas[index];
  const nuevoTitulo = prompt("Edita el t√≠tulo:", nota.titulo);
  if (nuevoTitulo === null) return;

  const nuevoContenido = prompt("Edita el contenido:", nota.contenido);
  if (nuevoContenido === null) return;

  notas[index] = { titulo: nuevoTitulo, contenido: nuevoContenido };
  renderNotas();
}

function eliminarNota(index) {
  if (confirm("¬øEst√°s seguro de que deseas eliminar esta nota?")) {
    notas.splice(index, 1);
    renderNotas();
  }
}

// Renderizar al cargar
renderNotas();


function guardarResumen() {
  const payload = {
  ...dataActual,
  texto1: document.getElementById("texto1").textContent,
  texto2: document.getElementById("texto2").textContent,
  texto3: document.getElementById("texto3").textContent,
  imagen1: document.getElementById("imagen1").src.replace(location.origin + "/", ""),
  imagen2: document.getElementById("imagen2").src.replace(location.origin + "/", ""),
  imagen3: document.getElementById("imagen3").src.replace(location.origin + "/", ""),
  array_de_notas: notas
  };

  fetch(`/api/enrrutamiento/${valor}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("‚úÖ Datos guardados correctamente.");
    } else {
      alert("‚ùå Error al guardar.");
    }
  })
  .catch(err => {
    console.error("‚ùå Error al enviar:", err);
    alert("‚ùå Error al enviar datos.");
  });
}



function editarNota(index) {
  const nota = notas[index];
  const nuevoTitulo = prompt("Edita el t√≠tulo:", nota.titulo);
  if (nuevoTitulo === null) return;

  const nuevoContenido = prompt("Edita el contenido:", nota.contenido);
  if (nuevoContenido === null) return;

  notas[index] = { titulo: nuevoTitulo, contenido: nuevoContenido };
  renderNotas();
}

function eliminarNota(index) {
  if (confirm("¬øEst√°s seguro de que deseas eliminar esta nota?")) {
    notas.splice(index, 1);
    renderNotas();
  }
}

// Renderizar al cargar
renderNotas();
</script>
</body>
</html>



