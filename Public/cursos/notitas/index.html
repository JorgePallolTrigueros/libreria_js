





<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Las tareas que debes tener</title>
  <script src="/assets/tailwind.js"></script>
  <link href="/assets/fonts.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background-color: #0f172a;
      color: white;
    }
    #search-input, #filter-select {
      background-color: rgb(31 41 55 / var(--tw-bg-opacity, 1));
      width: auto;
      height: 48px;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="bg-gradient-to-r from-purple-800 via-indigo-800 to-blue-800 p-4 text-center text-sm md:text-base font-semibold uppercase tracking-wider">
    <a href="../../d.html" class="mx-3 hover:text-yellow-400">Inicio</a>
  </nav>

  <!-- Encabezado con imagen y franja -->
  <section class="max-w-7xl mx-auto px-6 mb-10">
    <div class="relative flex items-center justify-between">
      <!-- Imagen circular -->
      <div class="absolute -left-4 md:-left-10 z-20">
        <img src="ima/imagen (14).png" alt="Imagen IA origen"
             class="w-40 h-40 md:w-52 md:h-52 object-cover rounded-full border-4 border-yellow-400 shadow-2xl">
      </div>

      <!-- Franja con t√≠tulo -->
      <div class="w-full bg-purple-800 h-28 md:h-32 rounded-xl flex items-center pl-48 pr-6 z-10 shadow-lg">
        <h2 class="text-2xl md:text-4xl text-yellow-400 font-bold ml-auto">Tareas ha hacer</h2>
      </div>
    </div>







<body class="p-6">


    <div id="formulario-insert" class="hidden mb-6">
          <input type="text" id="titulo-insert" placeholder="T√≠tulo" class="px-4 py-2 rounded mb-2 w-full bg-gray-800 text-white">
          <input type="text" id="descripcion-insert" placeholder="Descripci√≥n" class="px-4 py-2 rounded mb-2 w-full bg-gray-800 text-white">
          <input type="text" id="etiqueta-insert" placeholder="Etiqueta" class="px-4 py-2 rounded mb-2 w-full bg-gray-800 text-white">
          <input type="text" id="imagen-insert" placeholder="URL de imagen" class="px-4 py-2 rounded mb-2 w-full bg-gray-800 text-white">
          <button onclick="insertarNota()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">Guardar</button>
    </div>






<div id="modal-editar" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-gray-900 p-6 rounded-lg w-full max-w-md shadow-2xl">
    <h3 class="text-yellow-400 text-lg font-bold mb-4">‚úèÔ∏è Editar Nota</h3>
    <input type="hidden" id="editar-id">
    <input type="text" id="editar-titulo" placeholder="T√≠tulo" class="w-full mb-2 px-4 py-2 rounded bg-gray-800 text-white">
    <input type="text" id="editar-descripcion" placeholder="Descripci√≥n" class="w-full mb-2 px-4 py-2 rounded bg-gray-800 text-white">
    <input type="text" id="editar-etiqueta" placeholder="Etiqueta" class="w-full mb-2 px-4 py-2 rounded bg-gray-800 text-white">
<input type="file" id="editar-imagen" accept="image/*" class="w-full mb-4 px-4 py-2 rounded bg-gray-800 text-white">

    <div class="flex justify-end space-x-4">
      <button onclick="cerrarModal()" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600 text-white">Cancelar</button>
      <button onclick="guardarEdicion()" class="px-4 py-2 bg-green-500 rounded hover:bg-green-600 text-white">Guardar</button>
    </div>
  </div>
</div>




<div id="formulario-update" class="hidden mb-6">
  <input type="number" id="id-update" placeholder="ID de la nota a actualizar" class="px-4 py-2 rounded mb-2 w-full bg-gray-800 text-white">
  <input type="text" id="titulo-update" placeholder="Nuevo t√≠tulo" class="px-4 py-2 rounded mb-2 w-full bg-gray-800 text-white">
  <input type="text" id="descripcion-update" placeholder="Nueva descripci√≥n" class="px-4 py-2 rounded mb-2 w-full bg-gray-800 text-white">
  <button onclick="actualizarNota()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">Actualizar</button>
</div>
  
    <div class="max-w-7xl mx-auto">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-yellow-400 text-3xl font-bold"> <p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>Tareas Pendientes</h1>
        <button onclick="cambiarVista()" class="bg-yellow-400 text-black px-4 py-2 rounded hover:bg-yellow-500 transition">Cambiar Vista</button>
      </div>
  
      <!-- Filtro por etiqueta -->
      <div class="mb-6">
        <label for="filtro" class="mr-2">Filtrar por etiqueta:</label>
        <select id="filtro" onchange="rendernotitas()" class="bg-gray-800 text-white px-3 py-2 rounded">
          <option value="">Todas</option>
          <option value="IA">IA</option>
          <option value="Dise√±o">Dise√±o</option>
          <option value="C√≥digo">C√≥digo</option>
        </select>
      </div>
  
      <!-- Contenedor de tarjetas -->
      <div id="contenedor" class="grid gap-6"></div>
    </div>
  

<div class="mb-6 flex gap-4">
 <button onclick="abrirModalInsertar()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">‚ûï Insertar Nota</button>
</div>

<div id="modal-insertar" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-gray-900 p-6 rounded-lg w-full max-w-md shadow-2xl">
    <h3 class="text-yellow-400 text-lg font-bold mb-4">‚ûï Insertar Nueva Nota</h3>
    <input type="text" id="insertar-titulo" placeholder="T√≠tulo" class="w-full mb-2 px-4 py-2 rounded bg-gray-800 text-white">
    <input type="text" id="insertar-descripcion" placeholder="Descripci√≥n" class="w-full mb-2 px-4 py-2 rounded bg-gray-800 text-white">
    <input type="text" id="insertar-etiqueta" placeholder="Etiqueta" class="w-full mb-2 px-4 py-2 rounded bg-gray-800 text-white">
    <input type="file" id="insertar-imagen" accept="image/*" class="w-full mb-4 px-4 py-2 rounded bg-gray-800 text-white">
    <div class="flex justify-end space-x-4">
      <button onclick="cerrarModalInsertar()" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600 text-white">Cancelar</button>
      <button onclick="guardarNotaInsertada()" class="px-4 py-2 bg-green-500 rounded hover:bg-green-600 text-white">Guardar</button>
    </div>
  </div>
</div>
 </section>
<script>

function getnotitas() {
  if (!fs.existsSync(FILE_notitas)) {
    guardarnotitas([]); // crea el archivo si no existe
  }
  delete require.cache[require.resolve(FILE_notitas)];
  return require(FILE_notitas).data;
}




  let notitas = [];
  let vistaCuadricula = true;
  let paginaActual = 1;
  const notitasPorPagina = 8;

  // Cargar notitas desde el servidor
  fetch("/api/notitas")
    .then(res => res.json())
    .then(data => {
      notitas = data;
      rendernotitas();
    })
    .catch(err => console.error("‚ùå Error al cargar notitas:", err));

  function cambiarVista() {
    vistaCuadricula = !vistaCuadricula;
    rendernotitas();
  }

  function cambiarPagina(nuevaPagina) {
    paginaActual = nuevaPagina;
    rendernotitas();
  }

  function rendernotitas() {
    const contenedor = document.getElementById("contenedor");
    const filtro = document.getElementById("filtro").value;
    contenedor.innerHTML = "";

    const filtradas = filtro ? notitas.filter(n => n.etiqueta === filtro) : notitas;
    const totalPaginas = Math.ceil(filtradas.length / notitasPorPagina);
    if (paginaActual > totalPaginas) paginaActual = 1;

    const inicio = (paginaActual - 1) * notitasPorPagina;
    const fin = inicio + notitasPorPagina;
    const paginanotitas = filtradas.slice(inicio, fin);

    contenedor.className = vistaCuadricula
      ? "grid gap-6 md:grid-cols-4"
      : "flex flex-col gap-4";

    for (const nota of paginanotitas) {
      const card = document.createElement("div");
      card.className = "bg-gray-800 rounded-lg overflow-hidden shadow card";

      const contenido = `
        <img src="${nota.imagen_url}" alt="${nota.titulo}" class="${vistaCuadricula ? 'w-full h-40' : 'w-40 h-32'} object-cover ${vistaCuadricula ? '' : 'rounded-l-lg'}">
        <div class="p-4">
          <h2 class="text-lg text-yellow-300 font-bold mb-1">${nota.titulo}</h2>
          <p class="text-sm mb-1">${nota.descripcion}</p>
         
          <span class="text-xs text-gray-400">#${nota.etiqueta}</span>
         </br><button onclick="borrarNota(${nota.id_notas})" class="mt-2 px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-xs">üóëÔ∏è Borrar</button>
          <button onclick="editarNota(${nota.id_notas})" class="mt-2 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs">‚úèÔ∏è Editar</button>
        </div>
      `;
      card.innerHTML = vistaCuadricula ? contenido : `<div class="flex items-start gap-4">${contenido}</div>`;

      contenedor.appendChild(card);
    }

    renderPaginacion(totalPaginas);
  }

  function renderPaginacion(totalPaginas) {
    let paginador = document.getElementById("paginacion");
    if (!paginador) {
      paginador = document.createElement("div");
      paginador.id = "paginacion";
      paginador.className = "flex justify-center items-center gap-4 mt-8";
      document.querySelector(".max-w-7xl").appendChild(paginador);
    }
    paginador.innerHTML = "";

    const btnAnterior = document.createElement("button");
    btnAnterior.textContent = "‚¨ÖÔ∏è Anterior";
    btnAnterior.className = "px-3 py-2 bg-gray-700 rounded hover:bg-gray-600";
    btnAnterior.disabled = paginaActual === 1;
    btnAnterior.onclick = () => cambiarPagina(paginaActual - 1);

    const textoPagina = document.createElement("span");
    textoPagina.textContent = `P√°gina ${paginaActual} de ${totalPaginas}`;
    textoPagina.className = "text-sm text-yellow-400 font-semibold";

    const btnSiguiente = document.createElement("button");
    btnSiguiente.textContent = "Siguiente ‚û°Ô∏è";
    btnSiguiente.className = "px-3 py-2 bg-gray-700 rounded hover:bg-gray-600";
    btnSiguiente.disabled = paginaActual === totalPaginas;
    btnSiguiente.onclick = () => cambiarPagina(paginaActual + 1);

    paginador.appendChild(btnAnterior);
    paginador.appendChild(textoPagina);
    paginador.appendChild(btnSiguiente);
  }

  function abrirModalInsertar() {
    document.getElementById("modal-insertar").classList.remove("hidden");
  }

  function cerrarModalInsertar() {
    document.getElementById("modal-insertar").classList.add("hidden");
  }

  function guardarNotaInsertada() {
    const imagen = document.getElementById("insertar-imagen").files[0];
    const categoria = document.getElementById("insertar-etiqueta").value || "general";

    const formData = new FormData();
    formData.append("imagen", imagen);
    formData.append("categoria", categoria);
    formData.append("titulo", document.getElementById("insertar-titulo").value);
    formData.append("descripcion", document.getElementById("insertar-descripcion").value);
    formData.append("etiqueta", categoria);

    fetch("/api/notitas", {
      method: "POST",
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        fetch("/api/notitas")  // recargar todo de nuevo
          .then(res => res.json())
          .then(data => {
            notitas = data;
            cerrarModalInsertar();
            rendernotitas();
          });
      } else {
        alert("Error al insertar nota");
      }
    });
  }
function borrarNota(id) {
  if (!confirm("¬øEst√°s seguro de que quieres borrar esta nota?")) return;

  fetch(`/api/notitas/${id}`, {
    method: "DELETE"
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      notitas = notitas.filter(n => n.id_notas !== id);
      rendernotitas();
    } else {
      alert("‚ùå Error al borrar nota");
    }
  });
}
function editarNota(id) {
  const nota = notitas.find(n => n.id_notas === id);
  if (nota) {
    document.getElementById("editar-id").value = nota.id_notas; // ESTE L√çNEA ES CLAVE
    document.getElementById("editar-titulo").value = nota.titulo;
    document.getElementById("editar-descripcion").value = nota.descripcion;
    document.getElementById("editar-etiqueta").value = nota.etiqueta;
    document.getElementById("modal-editar").classList.remove("hidden");
  }
}

  function cerrarModal() {
    document.getElementById("modal-editar").classList.add("hidden");
  }

  function guardarEdicion() {
    const id = parseInt(document.getElementById("editar-id").value);
    const imagen = document.getElementById("editar-imagen").files[0];
    const categoria = document.getElementById("editar-etiqueta").value || "general";

    const formData = new FormData();
    formData.append("titulo", document.getElementById("editar-titulo").value);
    formData.append("descripcion", document.getElementById("editar-descripcion").value);
    formData.append("etiqueta", categoria);
    if (imagen) {
      formData.append("imagen", imagen);
    }

    fetch(`/api/notitas/${id}`, {
      method: "PUT",
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        fetch("/api/notitas")
          .then(res => res.json())
          .then(data => {
            notitas = data;
            cerrarModal();
            rendernotitas();
          });
      } else {
        alert("Error al actualizar nota");
      }
    });
  }
</script>
