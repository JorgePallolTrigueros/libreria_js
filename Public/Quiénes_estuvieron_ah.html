<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>¬øQui√©nes estuvieron aqu√≠?</title>
  <script src="/assets/tailwind.js"></script>
  <link href="/assets/fonts.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background-color: #0f172a;
      color: white;
    }
    #search-input, #filter-select {
      background-color: rgb(31 41 55 / var(--tw-bg-opacity, 1));
      width: auto;
      height: 48px;
    }
    .border-custom {
      border: solid 3px rgb(250, 204, 21);
    }

  #pregunta { margin: 20px; font-size: 1.2em; }
  .personaje { margin: 10px; display: inline-block; text-align: center; }
  .personaje img { width: 80px; height: 80px; object-fit: cover; border-radius: 50%; border: 2px solid yellow; }

    body {
      font-family: 'Orbitron', sans-serif;
      background-color: #0f172a;
      color: white;
    }
    #search-input, #filter-select {
      background-color: rgb(31 41 55 / var(--tw-bg-opacity, 1));
      width: auto;
      height: 48px;
    }
    .border-custom {
      border: solid 3px rgb(250, 204, 21);
    }

</style>
</head>
<body>
  <nav class="bg-gradient-to-r from-purple-800 via-indigo-800 to-blue-800 p-4 flex justify-between items-center text-sm md:text-base font-semibold uppercase tracking-wider">
    <!-- Botones de login/logout a la izquierda -->
    <div class="flex items-center space-x-2">
      <button id="loginBtn" onclick="toggleLogin()" class="text-white hover:text-yellow-400 text-xl" title="Iniciar sesi√≥n">üë§</button>
    </div>
  
    <!-- Men√∫ de navegaci√≥n centrado -->
    <div class="text-center flex-grow">
      <a href="index.html" class="mx-3 hover:text-yellow-400">Inicio</a>
    </div>
  </nav>

<section class="max-w-7xl mx-auto px-6 mb-10">
  <div class="relative flex items-center justify-between">
    <!-- Imagen redonda superpuesta -->
    <div class="absolute -left-4 md:-left-10 z-20 rounded-full overflow-hidden w-40 h-40 md:w-60 md:h-60 border-custom">
      <video id="videoPrincipal" autoplay muted loop class="w-full h-full object-cover">
        <source id="videoSource" src="" type="video/mp4">
        Tu navegador no soporta video HTML5.
      </video>
    </div>
    <!-- Franja violeta que atraviesa -->
    <div class="w-full bg-purple-800 h-28 md:h-32 rounded-xl flex items-center pl-48 pr-6 z-10 shadow-lg">
      <h2 id="tituloDinamico" class="text-2xl md:text-4xl text-yellow-400 font-bold ml-auto"></h2>
    </div>
  </div>
  <!-- Men√∫ din√°mico -->
  <nav id="dynamicMenu" class="flex justify-end mt-4 space-x-6 text-white text-sm md:text-base"></nav>
</section>







<h1 class="text-center text-3xl text-yellow-400 my-4">¬øQui√©nes estuvieron aqu√≠?</h1>
<div id="pregunta" class="text-center"></div>
<div id="personajes" class="flex flex-wrap justify-center"></div>
<button id="responder" class="block mx-auto bg-yellow-400 text-black font-bold py-2 px-4 rounded my-4">Responder</button>

<script src="enrrutamiento.js"></script>
<script>


const params = new URLSearchParams(window.location.search);
const valor = params.get("valor") || "novela";
const data = contenido[valor];

if (!data) {
  alert("Contenido no encontrado para: " + valor);
} else {
  // Carga el video de la cabecera
  const videoSource = document.getElementById("videoSource");
  const videoElement = document.getElementById("videoPrincipal");
  videoSource.src = `ruta/${data.video}`;
  videoElement.load();

  // Cambia el t√≠tulo din√°mico
  const tituloEl = document.getElementById("tituloDinamico");
  if (tituloEl) tituloEl.textContent = data.titulo;

  // Agrega el men√∫ din√°mico
  const dynamicMenu = document.getElementById("dynamicMenu");
  if (dynamicMenu) {
    dynamicMenu.innerHTML = `
  <a href="partes.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Partes de la novela</a>
  <a href="index copy.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Personajes</a>
  <a href="resumen.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Resumen</a>
  <a href="agrupamiento.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">agrupamiento</a>
  <a href="resumen.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Resumen</a>
  <a href="Qui√©nes_estuvieron_ah.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">1 Prueba</a>
  <a href="2_prueba.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">2 Prueba</a>
  <a href="juego3.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">2 Prueba</a>
    <a href="versiones.html?valor=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">Versiones</a>
  <a href="galeria_personaje.html=${valor}" class="hover:text-yellow-400 transition" style="font-size: 10px;">A√±adir Galeria</a>
    `;
  }
}



if (!data) {
  alert("Contenido no encontrado para: " + valor);
} else {
  const script = document.createElement("script");
  script.src = data.personajes;
  script.onload = () => {
    // Aqu√≠ armamos din√°micamente las escenas a partir de scenes, scenes_Personajes y PERSONAJES
    const escenas = scenes.map(scene => {
      const relacionados = scenes_Personajes
        .filter(rel => rel.id_scene === scene.id_scene)
        .map(rel => rel.id_personaje);
      return {
        texto: scene.nombre,
        relacionados: relacionados
      };
    });

    iniciarJuego(escenas);
  };
  document.head.appendChild(script);
}

function iniciarJuego(escenas) {
  let escenaActual = 0;
  let indicesEscenas = [];

  while (indicesEscenas.length < 10 && indicesEscenas.length < escenas.length) {
    let idx = Math.floor(Math.random() * escenas.length);
    if (!indicesEscenas.includes(idx)) indicesEscenas.push(idx);
  }

  mostrarEscena(escenas, indicesEscenas, escenaActual);
}

function mostrarEscena(escenas, indicesEscenas, escenaActual) {
  const escena = escenas[indicesEscenas[escenaActual]];
  document.getElementById('pregunta').textContent = escena.texto;

  const relacionados = escena.relacionados;
  const todosIds = PERSONAJES.map(p => p.id_Personaje);
  const noRelacionados = todosIds.filter(id => !relacionados.includes(id));

  let seleccionados = [...relacionados];
  while (seleccionados.length < 12 && noRelacionados.length > 0) {
    let randomId = noRelacionados[Math.floor(Math.random() * noRelacionados.length)];
    if (!seleccionados.includes(randomId)) seleccionados.push(randomId);
  }

  seleccionados.sort(() => Math.random() - 0.5);

  const contenedor = document.getElementById('personajes');
  contenedor.innerHTML = '';
  seleccionados.forEach(id => {
    const personaje = PERSONAJES.find(p => p.id_Personaje === id);
    const div = document.createElement('div');
    div.className = 'personaje';
    div.innerHTML = `
      <img src="${personaje.url_imagen}" alt="${personaje.Nombre}">
      <p>${personaje.Nombre}</p>
      <input type="checkbox" value="${personaje.id_Personaje}">
    `;
    contenedor.appendChild(div);
  });

  document.getElementById('responder').onclick = () => {
    const checkboxes = document.querySelectorAll('#personajes input:checked');
    const seleccionados = Array.from(checkboxes).map(cb => parseInt(cb.value));

    if (seleccionados.length === relacionados.length && seleccionados.every(id => relacionados.includes(id))) {
      alert('¬°Correcto! Pasamos a la siguiente escena.');
      escenaActual++;
      if (escenaActual < indicesEscenas.length) {
        mostrarEscena(escenas, indicesEscenas, escenaActual);
      } else {
        alert('¬°Has completado todas las escenas!');
      }
    } else {
      alert('¬°Incorrecto! Intenta nuevamente.');
      document.querySelectorAll('#personajes input').forEach(cb => cb.checked = false);
    }
  };
}

function toggleLogin() {
  const admin = localStorage.getItem("admin");
  const btn = document.getElementById("loginBtn");

  if (admin) {
    localStorage.removeItem("admin");
    btn.innerText = "üë§";
    alert("Sesi√≥n cerrada");
  } else {
    const usuario = prompt("Usuario:");
    const clave = prompt("Contrase√±a:");
    if (usuario === "sade" && clave === "123") {
      localStorage.setItem("admin", "true");
      btn.innerText = "‚ùå";
      alert("Sesi√≥n iniciada");
    } else {
      alert("Credenciales incorrectas");
    }
  }
}


</script>
</body>
</html>